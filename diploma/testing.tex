\section{Тестирование}
Для того, чтобы проверить корректность предложенного в данной работе метода конвертации абстрактных синтаксических деревьев, в ClickHouse были добавлены автоматизированные тесты, провереряюще: корректность работы парсера MySQL (юнит-тесты), корректность конвертации запросов на диалекте MySQL (функциональные тесты)

\subsection{Юнит-тесты}
В исходном репозитории выбранного MySQL парсера содержатся тесты, проверяющие его корректность. Их основой служит файл \textbf{statements.txt} с запросами, которые парсер MySQL должен преобразовать в дерево разбора без ошибок (см. Главу \ref{chap:mysql}).

Используя этот файл из исходного репозитория мною был написаны два юнит-теста, проверяющие корректность MySQL парсера встроенного в кодовую базу ClickHouse. ClickHouse использует фреймворк \textit{GoogleTest} в качестве инструмента для юнит-тестирования.

Первый юнит тест содержит простые запросы, выбранные из общего множества тестовых запросов, и проверяет корректность построенного по дереву разбора MySQL AST.

Второй юнит тест содержит все множество тестовых запросов и проверяет, что все запросы из этого множества обрабатываются без ошибок (корректность итогового MySQL AST не проверяется). Поскольку множество тестовых запросов включает в себя порядка 1000 запросов, было принято решение написать \textit{скрипт}, генерирующий исходный код теста на основе файла \textbf{statements.txt}, который был скопирован в директорию с юнит-тестами из исходного репозитория парсера

\subsection{Функциональные тесты}
Помимо тестов, проверяющих корректность работы парсера MySQL самого по себе, были написаны тесты, проверяющие корректность интерпретации запросов на диалекте MySQL в ClickHouse (функциональные тесты). ClickHouse использует собственный фреймворк, позволяющий осущеcтвлять функциональное тестирование. В простом случае (исключая специфичные тесты, которые не затрагивают данную работу) тест состоит из файла с расширением \textit{.sql}, описывающего последовательность запросов, и файла с расширением \textit{.ref} (refference file), содержащего \textit{ожидаемый ответ} ClickHouse на заданную последовательность запросов

Для проверки корректности метода конвертации в набор функциональных тестов ClickHouse были добавлены 2 теста:
\begin{enumerate}
    \item Тест, проверяющий корректность работы запросов \mintinline{sql}{ SELECT } на диалекте MySQL, не использующих таблицы. Тест проверяет корректность обработки выражений, фильтрацию комментариев и прочие базовые инварианты
    \item Тест, проверящий корректность поддерживаемых запросов на диалекте MySQL, работающих с таблицами. Проверяются запросы вида \mintinline{sql}{ USE database; }, \mintinline{sql}{ SHOW }, \mintinline{sql}{ DESCRIBE }, \mintinline{sql}{ SET }, а так же корректность работы операторов \mintinline{sql}{ LIMIT }, \mintinline{sql}{ WHERE }, \mintinline{sql}{ ORDER BY }, \mintinline{sql}{ GROUP BY }, \mintinline{sql}{ HAVING }, агрегатные функции и подзапросы.
\end{enumerate}

Тесты предполагают, что конфигурационный файл ClickHouse \textbf{не} содержит опции, включающей использование диалекта MySQL по умолчанию. Вместо этого в начале каждого теста, всем группам запросов на диалекте MySQL предшествует команда \mintinline{sql}{ SET sql_dialect = 'mysql';} (см. Главу \ref{chap:conversion}), последним запросом каждого теста является команда \mintinline{sql}{ SET sql_dialect='clickhouse'; }, возвращающая ClickHouse к собственному диалекту (для корректной работы с другими тестами)

\pagebreak
